<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Registrar mi Restaurante - DomiTuluá</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/frontend/foodie.css" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-custom">
      <div class="container">
        <a class="navbar-brand" href="/public/index.html">
          <i class="bi bi-house-door"></i>
          DomiTulua
        </a>
      </div>
    </nav>

    <main class="container" style="padding-top: 90px; max-width: 860px">
      <div class="card shadow-sm">
        <div class="card-header bg-warning text-white">
          <h5 class="mb-0">
            <i class="bi bi-pencil-square"></i> Registrar mi Restaurante
          </h5>
        </div>
        <div class="card-body">
          <p class="text-muted">
            Déjanos tus datos y nos pondremos en contacto contigo para afiliar
            tu restaurante a DomiTulua.
          </p>
          <form id="restaurantRegisterForm" class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Nombre del Restaurante *</label>
              <input type="text" class="form-control" name="name" required />
            </div>
            <div class="col-md-6">
              <label class="form-label">Propietario / Representante *</label>
              <input type="text" class="form-control" name="owner" required />
            </div>

            <div class="col-md-6">
              <label class="form-label">Teléfono *</label>
              <input type="tel" class="form-control" name="phone" required />
            </div>
            <div class="col-md-6">
              <label class="form-label">Email *</label>
              <input type="email" class="form-control" name="email" required />
            </div>

            <div class="col-12">
              <label class="form-label">Dirección *</label>
              <input type="text" class="form-control" name="address" required />
            </div>

            <div class="col-md-6">
              <label for="departamento" class="form-label"
                >Departamento *</label
              >
              <select
                id="departamento"
                name="departamento"
                class="form-select"
                required
              >
                <option value="">Seleccione...</option>
                <option value="1">Valle del Cauca</option>
                <option value="2">Cundinamarca</option>
                <option value="3">Antioquia</option>
                <option value="4">Caldas</option>
              </select>
            </div>
            <div class="col-md-6">
              <label for="municipio" class="form-label">Municipio *</label>
              <select
                id="municipio"
                name="municipio"
                class="form-select"
                required
                disabled
              >
                <option value="">Seleccione un departamento primero</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Categoría *</label>
              <select class="form-select" name="category" required>
                <option value="">Selecciona una categoría</option>
                <option>Comida Rápida</option>
                <option>Italiana</option>
                <option>Japonesa</option>
                <option>Mexicana</option>
                <option>Colombiana</option>
                <option>Parrilla</option>
                <option>Mariscos</option>
                <option>Vegana</option>
              </select>
            </div>

            <div class="col-12">
              <label class="form-label">Observaciones</label>
              <textarea
                class="form-control"
                name="notes"
                rows="3"
                placeholder="Horario, redes sociales, etc."
              ></textarea>
            </div>

            <div class="col-12 d-flex gap-2">
              <button type="submit" class="btn btn-warning">
                <i class="bi bi-send"></i> Enviar solicitud
              </button>
              <a id="mailtoLink" class="btn btn-outline-secondary" href="#"
                ><i class="bi bi-envelope"></i> Enviar por correo</a
              >
            </div>
            <div id="formMsg" class="mt-2 small"></div>
          </form>
        </div>
      </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <script>
      // Catálogo de departamentos y municipios
      const departamentos = {
        1: "Valle del Cauca",
        2: "Cundinamarca",
        3: "Antioquia",
        4: "Caldas",
      };

      const municipiosPorDepartamento = {
        1: [
          { id: "1", nombre: "Cali" },
          { id: "2", nombre: "Palmira" },
          { id: "3", nombre: "Jamundí" },
          { id: "4", nombre: "Tuluá" },
          { id: "5", nombre: "Buenaventura" },
          { id: "6", nombre: "Candelaria" },
        ],
        2: [
          { id: "7", nombre: "Bogotá" },
          { id: "8", nombre: "Soacha" },
          { id: "9", nombre: "Chía" },
          { id: "10", nombre: "Zipaquirá" },
          { id: "11", nombre: "Facatativá" },
        ],
        3: [
          { id: "12", nombre: "Medellín" },
          { id: "13", nombre: "Bello" },
          { id: "14", nombre: "Itagüí" },
          { id: "15", nombre: "Envigado" },
          { id: "16", nombre: "Rionegro" },
        ],
        4: [
          { id: "17", nombre: "Manizales" },
          { id: "18", nombre: "Chinchiná" },
          { id: "19", nombre: "La Dorada" },
          { id: "20", nombre: "Villamaría" },
          { id: "21", nombre: "Anserma" },
        ],
      };

      // Poblar municipios según departamento
      document.addEventListener("DOMContentLoaded", function () {
        const depSelect = document.getElementById("departamento");
        const munSelect = document.getElementById("municipio");

        if (depSelect && munSelect) {
          depSelect.addEventListener("change", function () {
            const depId = this.value;
            munSelect.innerHTML =
              '<option value="">Seleccione un municipio</option>';

            if (depId && municipiosPorDepartamento[depId]) {
              munSelect.disabled = false;
              municipiosPorDepartamento[depId].forEach((m) => {
                const opt = document.createElement("option");
                // Guardamos el nombre como value para que se vea bien en el email
                opt.value = m.nombre;
                opt.textContent = m.nombre;
                munSelect.appendChild(opt);
              });
            } else {
              munSelect.disabled = true;
              munSelect.innerHTML =
                '<option value="">Seleccione un departamento primero</option>';
            }
          });
        }
      });
      // Enviar sin backend: mostrar mensaje y preparar mailto como fallback
      document
        .getElementById("restaurantRegisterForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const formMsg = document.getElementById("formMsg");
          formMsg.className = "mt-2 small text-success";
          formMsg.textContent =
            "¡Gracias! Tu solicitud fue registrada. Nos contactaremos pronto.";
          // Opcional: aquí más adelante podemos enviar a un endpoint /api/v1/restaurants/apply
        });

      // Preparar mailto con datos del formulario
      const form = document.getElementById("restaurantRegisterForm");
      const mailto = document.getElementById("mailtoLink");
      function updateMailto() {
        const data = new FormData(form);
        const subject = encodeURIComponent(
          "Solicitud de registro de restaurante"
        );
        const depId = data.get("departamento");
        const depNombre = depId ? departamentos[depId] || depId : "";
        const munNombre = data.get("municipio") || "";
        const body = encodeURIComponent(
          `Nombre del Restaurante: ${data.get("name") || ""}\n` +
            `Propietario: ${data.get("owner") || ""}\n` +
            `Teléfono: ${data.get("phone") || ""}\n` +
            `Email: ${data.get("email") || ""}\n` +
            `Dirección: ${data.get("address") || ""}\n` +
            `Departamento: ${depNombre}\n` +
            `Municipio: ${munNombre}\n` +
            `Categoría: ${data.get("category") || ""}\n` +
            `Observaciones: ${data.get("notes") || ""}\n`
        );
        mailto.href = `mailto:contacto@domitulua.com?subject=${subject}&body=${body}`;
      }
      form.addEventListener("input", updateMailto);
      updateMailto();
    </script>
  </body>
</html>
