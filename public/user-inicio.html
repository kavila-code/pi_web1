<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inicio - DomiTulua</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/frontend/foodie.css" />
    <link rel="stylesheet" href="/frontend/user-inicio.css" />
  </head>

  <body class="user-inicio-body">
    <!-- Top Navigation -->
    <nav class="navbar navbar-expand-lg navbar-custom">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="/public/user-inicio.html">
          <i class="bi bi-truck me-2"></i>
          <span>DomiTulua</span>
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <!-- Links de navegaci√≥n alineados a la izquierda (misma estructura que en index.html) -->
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link active" href="/public/user-inicio.html">
                <i class="bi bi-house me-1"></i>Inicio
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#restaurantes">Restaurantes</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#ofertas">Ofertas</a>
            </li>
          </ul>

          <!-- Acciones del navbar alineadas a la derecha: usar misma estructura y clases que en index.html -->
          <div class="navbar-actions d-flex align-items-center">
            <!-- User dropdown first -->
            <div class="nav-item dropdown ms-2">
              <a
                class="btn btn-login dropdown-toggle d-flex align-items-center"
                href="#"
                id="userMenuBtn"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="bi bi-person-circle me-1" aria-hidden="true"></i>
                <span id="userGreeting">Mi Cuenta</span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenuBtn">
                <li>
                  <a class="dropdown-item" href="/public/user-dashboard.html">
                    <i class="bi bi-speedometer2"></i> Mi Dashboard
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="#mis-pedidos">
                    <i class="bi bi-bag"></i> Mis Pedidos
                  </a>
                </li>
                <li>
                  <a class="dropdown-item" href="#favoritos">
                    <i class="bi bi-heart"></i> Favoritos
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="#" onclick="logout()">
                    <i class="bi bi-box-arrow-right"></i> Cerrar Sesi√≥n
                  </a>
                </li>
              </ul>
            </div>

            <!-- Cart button positioned to the right of Mi Cuenta -->
            <div class="ms-3 position-relative">
              <button id="cartButton" class="btn-cart" aria-label="Carrito">
                <i class="bi bi-cart3"></i>
                <span class="cart-count" id="cartCount">0</span>
              </button>
              <!-- Cart preview (hidden; toggled by JS) -->
              <div id="cartPreview" class="cart-preview shadow-sm bg-white rounded" style="display:none;">
                <div class="p-3">
                  <h6 class="mb-2">Tu carrito</h6>
                  <div id="cartItemsContainer">
                    <p class="text-muted">Tu carrito est√° vac√≠o.</p>
                  </div>
                  <div class="mt-3 d-flex justify-content-between align-items-center">
                    <strong id="cartTotal">Total: $0</strong>
                    <div>
                      <a href="/public/checkout.html" id="gotoCheckout" class="btn btn-primary btn-sm">Ir a pagar</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Welcome Hero Section (unificado con homepage) -->
    <section class="hero-section">
      <div class="container">
        <h1>
          <span id="personalGreeting">¬°Hola!</span>
          <span class="highlight">¬øQu√© te apetece hoy?</span>
        </h1>
        <p>Descubre los mejores restaurantes y disfruta de tus platillos favoritos</p>

        <!-- Buscador Principal -->
        <div class="search-container">
          <div class="search-box">
            <i class="bi bi-search search-icon"></i>
            <input
              type="text"
              class="search-input"
              placeholder="¬øQu√© quieres pedir hoy? Pizza, hamburguesa, sushi..."
              id="mainSearch"
            />
            <button class="search-btn" aria-label="Buscar">
              <i class="bi bi-arrow-right"></i>
            </button>
          </div>

          <!-- Sugerencias r√°pidas -->
          <div class="quick-suggestions">
            <span class="suggestion-label">Popular:</span>
            <button class="suggestion-tag">üçï Pizza</button>
            <button class="suggestion-tag">üçî Hamburguesa</button>
            <button class="suggestion-tag">üç£ Sushi</button>
            <button class="suggestion-tag">üåÆ Tacos</button>
            <button class="suggestion-tag">üçù Pasta</button>
          </div>
        </div>

        <!-- botones principales eliminados en esta vista por requerimiento -->
      </div>
    </section>

    <!-- Restaurantes Afiliados (movido desde homepage) -->
    <section class="restaurants-section" id="restaurantes">
      <div class="container">
        <div class="text-center mb-5">
          <h2>Restaurantes Afiliados</h2>
          <p class="section-subtitle">Descubre los mejores restaurantes de Tulu√°</p>
          <div class="mt-3">
            <a href="#" class="btn btn-register-restaurant" onclick="openRestaurantRegistration(event)">
              <i class="bi bi-shop"></i> ¬øTienes un restaurante? ¬°Reg√≠stralo aqu√≠!
            </a>
          </div>
        </div>
        <div class="row" id="affiliatedRestaurantsStatic">
          <div class="col-lg-4 col-md-6 mb-4">
            <div class="restaurant-card">
              <div class="restaurant-image">
                <img src="/imagenes/restaurantes/LA%20BELLA%20ITALIA.jpg" alt="Restaurante Italiano" />
                <div class="restaurant-rating"><i class="bi bi-star-fill"></i><span>4.8</span></div>
              </div>
              <div class="restaurant-content">
                <h4>La Bella Italia</h4>
                <p class="restaurant-category">Comida Italiana</p>
                <p class="restaurant-description">Aut√©ntica cocina italiana con ingredientes frescos</p>
                <div class="restaurant-info">
                  <span class="delivery-time"><i class="bi bi-clock"></i>30-45 min</span>
                  <span class="delivery-cost"><i class="bi bi-truck"></i>$3.000</span>
                </div>
                <button class="btn-view-restaurant" onclick="location.href='/public/restaurant-menu.html?id=1'">Ver Men√∫</button>
              </div>
            </div>
          </div>
          <div class="col-lg-4 col-md-6 mb-4">
            <div class="restaurant-card">
              <div class="restaurant-image">
                <img src="/imagenes/restaurantes/SAKURA%20SUSHI.jpg" alt="Restaurante Japon√©s" />
                <div class="restaurant-rating"><i class="bi bi-star-fill"></i><span>4.9</span></div>
              </div>
              <div class="restaurant-content">
                <h4>Sakura Sushi</h4>
                <p class="restaurant-category">Comida Japonesa</p>
                <p class="restaurant-description">Los mejores sushi y rolls de la ciudad</p>
                <div class="restaurant-info">
                  <span class="delivery-time"><i class="bi bi-clock"></i>25-40 min</span>
                  <span class="delivery-cost"><i class="bi bi-truck"></i>$2.500</span>
                </div>
                <button class="btn-view-restaurant" onclick="location.href='/public/restaurant-menu.html?id=3'">Ver Men√∫</button>
              </div>
            </div>
          </div>
          <div class="col-lg-4 col-md-6 mb-4">
            <div class="restaurant-card">
              <div class="restaurant-image">
                <img src="/imagenes/restaurantes/burger-master.jpg" alt="Hamburguesas" />
                <div class="restaurant-rating"><i class="bi bi-star-fill"></i><span>4.7</span></div>
              </div>
              <div class="restaurant-content">
                <h4>Burger Master</h4>
                <p class="restaurant-category">Hamburguesas Gourmet</p>
                <p class="restaurant-description">Las hamburguesas m√°s jugosas y sabrosas</p>
                <div class="restaurant-info">
                  <span class="delivery-time"><i class="bi bi-clock"></i>20-35 min</span>
                  <span class="delivery-cost"><i class="bi bi-truck"></i>$3.500</span>
                </div>
                <button class="btn-view-restaurant" onclick="location.href='/public/restaurant-menu.html?id=2'">Ver Men√∫</button>
              </div>
            </div>
          </div>
        </div>
        <div class="text-center mt-5">
          <a href="/public/restaurants.html" class="btn btn-outline-custom">
            <i class="bi bi-building me-2"></i>Ver Todos los Restaurantes
          </a>
        </div>
      </div>
    </section>

    <!-- Quick Stats Section -->
    <section class="quick-stats">
      <div class="container">
        <div class="row">
          <div class="col-md-3 col-6">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="bi bi-bag-check"></i>
              </div>
              <div class="stat-content">
                <h3 id="totalOrders">12</h3>
                <p>Pedidos Realizados</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-6">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="bi bi-heart-fill"></i>
              </div>
              <div class="stat-content">
                <h3 id="favoriteRestaurants">5</h3>
                <p>Restaurantes Favoritos</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-6">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="bi bi-star-fill"></i>
              </div>
              <div class="stat-content">
                <h3 id="loyaltyPoints">350</h3>
                <p>Puntos Acumulados</p>
              </div>
            </div>
          </div>
          <div class="col-md-3 col-6">
            <div class="stat-card">
              <div class="stat-icon">
                <i class="bi bi-percent"></i>
              </div>
              <div class="stat-content">
                <h3 id="totalSavings">15%</h3>
                <p>Ahorros del Mes</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Recent Orders Section -->
    <section class="recent-orders" id="recent-orders">
      <div class="container">
        <div class="section-header">
          <h2><i class="bi bi-clock-history"></i> Pedidos Recientes</h2>
          <a href="/public/user-dashboard.html" class="btn btn-outline-primary"
            >Ver Todos</a
          >
        </div>

        <div class="row" id="recentOrdersRow">
          <div class="text-center py-5" id="recentOrdersLoading">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="mt-3 text-muted">Cargando pedidos...</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Special Offers Section -->
    <section class="special-offers" id="ofertas">
      <div class="container">
        <div class="section-header">
          <h2><i class="bi bi-fire"></i> Ofertas Especiales</h2>
          <span class="badge bg-danger">¬°Limitadas!</span>
        </div>

        <div class="row">
          <div class="col-lg-6 mb-4">
            <div class="offer-card featured">
              <div class="offer-badge">-30%</div>
              <div class="offer-content">
                <div class="offer-info">
                  <h4>Pizza Grande + Gaseosa</h4>
                  <p>En Pizza Palace - Solo hoy</p>
                  <div class="offer-price">
                    <span class="old-price">$35.00</span>
                    <span class="new-price">$24.50</span>
                  </div>
                </div>
                <button class="btn btn-primary">Ordenar Ahora</button>
              </div>
            </div>
          </div>

          <div class="col-lg-6 mb-4">
            <div class="offer-card">
              <div class="offer-badge">-25%</div>
              <div class="offer-content">
                <div class="offer-info">
                  <h4>Combo Familiar</h4>
                  <p>En Burger Express - Weekend</p>
                  <div class="offer-price">
                    <span class="old-price">$45.00</span>
                    <span class="new-price">$33.75</span>
                  </div>
                </div>
                <button class="btn btn-primary">Ordenar Ahora</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Favorite Restaurants Section -->
    <!-- Nuestro Men√∫ (copiado desde homepage) -->
    <section class="menu-section" id="menu">
      <div class="container">
        <div class="text-center mb-5">
          <h2>Nuestro Men√∫</h2>
          <p class="section-subtitle">
            Explora nuestra deliciosa variedad de platos
          </p>
        </div>

        <!-- Filtros de categor√≠as -->
        <div class="menu-filters text-center mb-5">
          <button class="filter-btn active" data-filter="all">
            <i class="bi bi-grid-3x3-gap me-2"></i>Todo
          </button>
          <button class="filter-btn" data-filter="pizza">
            <i class="bi bi-circle me-2"></i>Pizza
          </button>
          <button class="filter-btn" data-filter="burger">
            <i class="bi bi-list me-2"></i>Hamburguesas
          </button>
          <button class="filter-btn" data-filter="sushi">
            <i class="bi bi-star me-2"></i>Sushi
          </button>
          <button class="filter-btn" data-filter="dessert">
            <i class="bi bi-heart me-2"></i>Postres
          </button>
          <button class="filter-btn" data-filter="drink">
            <i class="bi bi-cup-straw me-2"></i>Bebidas
          </button>
        </div>

        <!-- Grid de productos -->
        <div class="row menu-grid">
          <!-- Pizza -->
          <div class="col-lg-4 col-md-6 mb-4 menu-item" data-category="pizza">
            <div class="menu-card">
              <div class="menu-image">
                <img
                  src="/imagenes/comida/PIZZA-MARGHERITA.jpg"
                  alt="Pizza Margherita"
                />
                <div class="menu-badge">Popular</div>
              </div>
              <div class="menu-content">
                <h4>Pizza Margherita</h4>
                <p>Deliciosa pizza con tomate, mozzarella fresca y albahaca</p>
                <div class="menu-footer">
                  <span class="price">$25.000</span>
                  <button class="btn-add-cart">
                    <i class="bi bi-cart-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Hamburguesa -->
          <div class="col-lg-4 col-md-6 mb-4 menu-item" data-category="burger">
            <div class="menu-card">
              <div class="menu-image">
                <img
                  src="/imagenes/comida/hamburguesa-clasica.jpg"
                  alt="Hamburguesa Cl√°sica"
                />
                <div class="menu-badge new">Nuevo</div>
              </div>
              <div class="menu-content">
                <h4>Burger Cl√°sica</h4>
                <p>Carne de res, lechuga, tomate, queso</p>
                <div class="menu-footer">
                  <span class="price">$18.000</span>
                  <button class="btn-add-cart">
                    <i class="bi bi-cart-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Burger BBQ Bacon -->
          <div class="col-lg-4 col-md-6 mb-4 menu-item" data-category="burger">
            <div class="menu-card">
              <div class="menu-image">
                <img
                  src="/imagenes/comida/burguer bbq bacon.jpeg"
                  alt="Burger BBQ Bacon"
                />
                <div class="menu-badge">Popular</div>
              </div>
              <div class="menu-content">
                <h4>Burger BBQ Bacon</h4>
                <p>Carne, tocineta, queso, salsa BBQ</p>
                <div class="menu-footer">
                  <span class="price">$22.000</span>
                  <button class="btn-add-cart">
                    <i class="bi bi-cart-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Burger Vegetariana -->
          <div class="col-lg-4 col-md-6 mb-4 menu-item" data-category="burger">
            <div class="menu-card">
              <div class="menu-image">
                <img
                  src="/imagenes/comida/burger vegetariana.jpg"
                  alt="Burger Vegetariana"
                />
              </div>
              <div class="menu-content">
                <h4>Burger Vegetariana</h4>
                <p>Hamburguesa de quinoa y vegetales</p>
                <div class="menu-footer">
                  <span class="price">$19.000</span>
                  <button class="btn-add-cart">
                    <i class="bi bi-cart-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Papas Fritas Grandes -->
          <div class="col-lg-4 col-md-6 mb-4 menu-item" data-category="burger">
            <div class="menu-card">
              <div class="menu-image">
                <img
                  src="/imagenes/comida/papas fritas grandes.png"
                  alt="Papas Fritas Grandes"
                />
              </div>
              <div class="menu-content">
                <h4>Papas Fritas Grandes</h4>
                <p>Papas crujientes con sal</p>
                <div class="menu-footer">
                  <span class="price">$8.000</span>
                  <button class="btn-add-cart">
                    <i class="bi bi-cart-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Aros de Cebolla -->
          <div class="col-lg-4 col-md-6 mb-4 menu-item" data-category="burger">
            <div class="menu-card">
              <div class="menu-image">
                <img
                  src="/imagenes/comida/aros de cebolla.jpeg"
                  alt="Aros de Cebolla"
                />
              </div>
              <div class="menu-content">
                <h4>Aros de Cebolla</h4>
                <p>Aros de cebolla empanizados</p>
                <div class="menu-footer">
                  <span class="price">$9.000</span>
                  <button class="btn-add-cart">
                    <i class="bi bi-cart-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Nuggets de Pollo -->
          <div class="col-lg-4 col-md-6 mb-4 menu-item" data-category="burger">
            <div class="menu-card">
              <div class="menu-image">
                <img
                  src="/imagenes/comida/nuggets de pollo (!0 und).jpg"
                  alt="Nuggets de Pollo"
                />
              </div>
              <div class="menu-content">
                <h4>Nuggets de Pollo (10 und)</h4>
                <p>Nuggets de pollo crujientes</p>
                <div class="menu-footer">
                  <span class="price">$15.000</span>
                  <button class="btn-add-cart">
                    <i class="bi bi-cart-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Malteada de Chocolate -->
          <div class="col-lg-4 col-md-6 mb-4 menu-item" data-category="drink">
            <div class="menu-card">
              <div class="menu-image">
                <img
                  src="/imagenes/comida/malteada de chocolate.jpg"
                  alt="Malteada de Chocolate"
                />
              </div>
              <div class="menu-content">
                <h4>Malteada de Chocolate</h4>
                <p>Cremosa malteada de chocolate</p>
                <div class="menu-footer">
                  <span class="price">$7.000</span>
                  <button class="btn-add-cart">
                    <i class="bi bi-cart-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Sushi -->
          <div class="col-lg-4 col-md-6 mb-4 menu-item" data-category="sushi">
            <div class="menu-card">
              <div class="menu-image">
                <img
                  src="/imagenes/comida/Sushi%20california%20roll.png"
                  alt="Sushi Roll"
                />
              </div>
              <div class="menu-content">
                <h4>Sushi California Roll</h4>
                <p>Rollo de sushi con cangrejo, aguacate y pepino</p>
                <div class="menu-footer">
                  <span class="price">$32.000</span>
                  <button class="btn-add-cart">
                    <i class="bi bi-cart-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- M√°s productos... -->
          <div class="col-lg-4 col-md-6 mb-4 menu-item" data-category="dessert">
            <div class="menu-card">
              <div class="menu-image">
                <img
                  src="/imagenes/comida/cheesecake%20de%20fresa.png"
                  alt="Cheesecake"
                />
              </div>
              <div class="menu-content">
                <h4>Cheesecake de Fresa</h4>
                <p>Cremoso cheesecake con salsa de fresas frescas</p>
                <div class="menu-footer">
                  <span class="price">$12.000</span>
                  <button class="btn-add-cart">
                    <i class="bi bi-cart-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-4 col-md-6 mb-4 menu-item" data-category="drink">
            <div class="menu-card">
              <div class="menu-image">
                <img
                  src="/imagenes/comida/Smoothie%20Tropical.jpg"
                  alt="Smoothie"
                />
              </div>
              <div class="menu-content">
                <h4>Smoothie Tropical</h4>
                <p>Refrescante batido de mango, pi√±a y maracuy√°</p>
                <div class="menu-footer">
                  <span class="price">$8.000</span>
                  <button class="btn-add-cart">
                    <i class="bi bi-cart-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-4 col-md-6 mb-4 menu-item" data-category="pizza">
            <div class="menu-card">
              <div class="menu-image">
                <img
                  src="/imagenes/comida/pizza%20pepperoni.jpg"
                  alt="Pizza Pepperoni"
                />
              </div>
              <div class="menu-content">
                <h4>Pizza Pepperoni</h4>
                <p>Pizza cl√°sica con pepperoni y queso mozzarella</p>
                <div class="menu-footer">
                  <span class="price">$28.000</span>
                  <button class="btn-add-cart">
                    <i class="bi bi-cart-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="text-center mt-5">
          <a href="#restaurantes" class="btn btn-primary-custom" title="Ver el listado completo de restaurantes">
            <i class="bi bi-eye me-2"></i>Ver Men√∫ Completo
          </a>
        </div>
      </div>
    </section>
    <section class="favorite-restaurants" id="favoritos">
      <div class="container">
        <div class="section-header">
          <h2><i class="bi bi-heart-fill"></i> Tus Restaurantes Favoritos</h2>
          <a href="#" class="btn btn-outline-primary">Explorar M√°s</a>
        </div>

        <div class="row">
          <div class="col-lg-3 col-md-6 mb-4">
            <div class="restaurant-card favorite" onclick="location.href='/public/restaurant-menu.html?id=1'" style="cursor:pointer">
              <div class="restaurant-image">
                <img
                  src="/imagenes/restaurantes/LA%20BELLA%20ITALIA.jpg"
                  alt="Pizza Palace"
                  onerror="this.src='/frontend/placeholder-restaurant.svg'"
                />
                <div class="favorite-badge">
                  <i class="bi bi-heart-fill"></i>
                </div>
              </div>
              <div class="restaurant-info">
                <h5>Pizza Palace</h5>
                <div class="restaurant-rating">
                  <i class="bi bi-star-fill"></i>
                  <span>4.8</span>
                  <small>(127 rese√±as)</small>
                </div>
                <p class="restaurant-category">Pizza ‚Ä¢ Italiana ‚Ä¢ $$$</p>
                <div class="restaurant-meta">
                  <span class="delivery-time">
                    <i class="bi bi-clock"></i> 25-35 min
                  </span>
                  <span class="delivery-fee">
                    <i class="bi bi-truck"></i> Gratis
                  </span>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-3 col-md-6 mb-4">
            <div class="restaurant-card favorite" onclick="location.href='/public/restaurant-menu.html?id=2'" style="cursor:pointer">
              <div class="restaurant-image">
                <img
                  src="/imagenes/restaurantes/burger-master.jpg"
                  alt="Burger Express"
                  onerror="this.src='/frontend/placeholder-restaurant.svg'"
                />
                <div class="favorite-badge">
                  <i class="bi bi-heart-fill"></i>
                </div>
              </div>
              <div class="restaurant-info">
                <h5>Burger Express</h5>
                <div class="restaurant-rating">
                  <i class="bi bi-star-fill"></i>
                  <span>4.6</span>
                  <small>(89 rese√±as)</small>
                </div>
                <p class="restaurant-category">Hamburguesas ‚Ä¢ Americana ‚Ä¢ $$</p>
                <div class="restaurant-meta">
                  <span class="delivery-time">
                    <i class="bi bi-clock"></i> 20-30 min
                  </span>
                  <span class="delivery-fee">
                    <i class="bi bi-truck"></i> $2.50
                  </span>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-3 col-md-6 mb-4">
            <div class="restaurant-card favorite" onclick="location.href='/public/restaurant-menu.html?id=3'" style="cursor:pointer">
              <div class="restaurant-image">
                <img
                  src="/imagenes/restaurantes/SAKURA%20SUSHI.jpg"
                  alt="Sushi Zen"
                  onerror="this.src='/frontend/placeholder-restaurant.svg'"
                />
                <div class="favorite-badge">
                  <i class="bi bi-heart-fill"></i>
                </div>
              </div>
              <div class="restaurant-info">
                <h5>Sushi Zen</h5>
                <div class="restaurant-rating">
                  <i class="bi bi-star-fill"></i>
                  <span>4.9</span>
                  <small>(156 rese√±as)</small>
                </div>
                <p class="restaurant-category">Sushi ‚Ä¢ Japonesa ‚Ä¢ $$$$</p>
                <div class="restaurant-meta">
                  <span class="delivery-time">
                    <i class="bi bi-clock"></i> 35-45 min
                  </span>
                  <span class="delivery-fee">
                    <i class="bi bi-truck"></i> Gratis
                  </span>
                </div>
              </div>
            </div>
          </div>

          <div class="col-lg-3 col-md-6 mb-4">
            <div class="restaurant-card favorite" onclick="location.href='/public/restaurant-menu.html?id=14'" style="cursor:pointer">
              <div class="restaurant-image">
                <img
                  src="/imagenes/restaurantes/AZTECA%20MEXICANO.jpg"
                  alt="Taco Fiesta"
                  onerror="this.src='/frontend/placeholder-restaurant.svg'"
                />
                <div class="favorite-badge">
                  <i class="bi bi-heart-fill"></i>
                </div>
              </div>
              <div class="restaurant-info">
                <h5>Taco Fiesta</h5>
                <div class="restaurant-rating">
                  <i class="bi bi-star-fill"></i>
                  <span>4.7</span>
                  <small>(94 rese√±as)</small>
                </div>
                <p class="restaurant-category">Mexicana ‚Ä¢ Tacos ‚Ä¢ $$</p>
                <div class="restaurant-meta">
                  <span class="delivery-time">
                    <i class="bi bi-clock"></i> 15-25 min
                  </span>
                  <span class="delivery-fee">
                    <i class="bi bi-truck"></i> $1.50
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- All Restaurants Section -->
    <section class="all-restaurants" id="restaurantes">
      <div class="container">
        <div class="section-header">
          <h2><i class="bi bi-shop"></i> Todos los Restaurantes</h2>
          <div class="filter-controls">
            <select class="form-select" id="sortRestaurants">
              <option value="rating">Mejor Calificados</option>
              <option value="delivery-time">Tiempo de Entrega</option>
              <option value="price-low">Precio: Menor a Mayor</option>
              <option value="price-high">Precio: Mayor a Menor</option>
            </select>
          </div>
        </div>

        <div class="row" id="restaurantsList">
          <!-- Los restaurantes se cargar√°n din√°micamente aqu√≠ -->
        </div>

        <div class="text-center mt-4">
          <button class="btn btn-outline-primary" id="loadMoreRestaurants" title="Click: cargar m√°s. Shift+Click: ver previsualizaci√≥n de todos">
            Cargar M√°s Restaurantes
          </button>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <div class="footer-brand">
              <h5>DomiTulua</h5>
              <p>Tu comida favorita, entregada con amor</p>
            </div>
          </div>
        </div>
        <hr />
        <div class="text-center">
          <p>&copy; 2025 DomiTulua. Todos los derechos reservados.</p>
        </div>
      </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Common JS (shared utilities and load-more for restaurants) -->
  <script src="/frontend/js/common.js"></script>
  <script src="/frontend/js/cart.js"></script>
  <script src="/frontend/js/index.js"></script>

    <!-- Custom JavaScript -->
    <script>
      // Variables globales
      let currentUser = null;

      // Verificaci√≥n de autenticaci√≥n
      document.addEventListener("DOMContentLoaded", function () {
        const token = localStorage.getItem("token");
        const user = JSON.parse(localStorage.getItem("user") || "{}");

        if (!token) {
          window.location.href = "/login";
          return;
        }

        // Verificar si es admin y redirigir
        if (user.role === "admin") {
          window.location.href = "/admin-dashboard";
          return;
        }

      currentUser = user;
  loadUserData(user);
  // Inicializar la lista de restaurantes desde la lista maestra y renderizar los primeros
  try {
    if (typeof window._CURRENT_RESTAURANTS === 'undefined') window._CURRENT_RESTAURANTS = getAllRestaurants();
    // Renderizar 6 iniciales (o ajustar seg√∫n prefieras)
    renderRestaurantsContainer(6, '#restaurantsList');
  } catch (e) {
    // Fallback a la implementaci√≥n local si las utilidades no est√°n disponibles
    loadRestaurants();
  }

  // Inicializar comportamiento de 'Cargar M√°s Restaurantes'
  try { initLoadMoreRestaurants(); } catch (e) { console.warn('initLoadMoreRestaurants no disponible:', e); }

  // Event listeners
  setupEventListeners();

  // Cargar pedidos recientes pagados
  loadRecentOrders();
      });

      function loadUserData(user) {
        // Personalizar saludo
        const greeting = document.getElementById("personalGreeting");
        const userMenu = document.getElementById("userGreeting");

        if (user.nombre) {
          greeting.textContent = `¬°Hola ${user.nombre}!`;
          userMenu.textContent = user.nombre;
        }

        // Cargar estad√≠sticas del usuario (simuladas)
        loadUserStats();
      }

      function loadUserStats() {
        // Simular carga de estad√≠sticas
        const stats = {
          totalOrders: Math.floor(Math.random() * 50) + 5,
          favoriteRestaurants: Math.floor(Math.random() * 10) + 3,
          loyaltyPoints: Math.floor(Math.random() * 500) + 100,
          totalSavings: Math.floor(Math.random() * 25) + 10,
        };

        document.getElementById("totalOrders").textContent = stats.totalOrders;
        document.getElementById("favoriteRestaurants").textContent =
          stats.favoriteRestaurants;
        document.getElementById("loyaltyPoints").textContent =
          stats.loyaltyPoints;
        document.getElementById("totalSavings").textContent =
          stats.totalSavings + "%";
      }

      function loadRestaurants() {
        // Simulaci√≥n de restaurantes (usar im√°genes desde IMAGENES/RESTAURANTES)
        const restaurants = [
          {
            id: 1,
            name: "Casa de las Empanadas",
            category: "Colombiana ‚Ä¢ Empanadas ‚Ä¢ $$",
            rating: 4.5,
            reviews: 78,
            deliveryTime: "20-30 min",
            deliveryFee: "Gratis",
            image: "/imagenes/restaurantes/la%20casa%20de%20las%20empanadas.png",
          },
          {
            id: 2,
            name: "Parrilla Los Amigos",
            category: "Parrilla ‚Ä¢ Carnes ‚Ä¢ $$$",
            rating: 4.7,
            reviews: 132,
            deliveryTime: "30-40 min",
            deliveryFee: "$3.00",
            image: "/imagenes/restaurantes/parrilla%20los%20amigos.jpg",
          },
          {
            id: 3,
            name: "Caf√© Central",
            category: "Caf√© ‚Ä¢ Desayunos ‚Ä¢ $$",
            rating: 4.6,
            reviews: 89,
            deliveryTime: "15-25 min",
            deliveryFee: "$2.00",
            image: "/imagenes/restaurantes/cafe%20central.jpg",
          },
          {
            id: 4,
            name: "Pollo Dorado",
            category: "Pollo ‚Ä¢ Comida R√°pida ‚Ä¢ $$",
            rating: 4.4,
            reviews: 156,
            deliveryTime: "20-30 min",
            deliveryFee: "$2.50",
            image: "/imagenes/restaurantes/pollo%20dorado.png",
          },
          {
            id: 5,
            name: "Helader√≠a Tropical",
            category: "Helados ‚Ä¢ Postres ‚Ä¢ $",
            rating: 4.8,
            reviews: 67,
            deliveryTime: "10-20 min",
            deliveryFee: "$1.50",
            image: "/imagenes/restaurantes/heladeria%20tropical.jpg",
          },
          {
            id: 6,
            name: "Comida China Dragon",
            category: "China ‚Ä¢ Asi√°tica ‚Ä¢ $$",
            rating: 4.3,
            reviews: 98,
            deliveryTime: "25-35 min",
            deliveryFee: "$2.50",
            image: "/imagenes/restaurantes/comida%20china%20dragon.jpg",
          },
        ];

        const restaurantsList = document.getElementById("restaurantsList");
        restaurantsList.innerHTML = "";

        restaurants.forEach((restaurant) => {
          const restaurantCard = createRestaurantCard(restaurant);
          restaurantsList.appendChild(restaurantCard);
        });
      }

      function createRestaurantCard(restaurant) {
        const col = document.createElement("div");
        col.className = "col-lg-4 col-md-6 mb-4";

        col.innerHTML = `
          <div class="restaurant-card" onclick="location.href='/public/restaurant-menu.html?id=${restaurant.id}'" style="cursor:pointer">
            <div class="restaurant-image">
              <img src="${restaurant.image}" alt="${restaurant.name}" onerror="this.src='/frontend/placeholder-restaurant.svg'">
              <div class="favorite-toggle" onclick="event.stopPropagation();toggleFavorite(${restaurant.id})">
                <i class="bi bi-heart"></i>
              </div>
            </div>
            <div class="restaurant-info">
              <h5>${restaurant.name}</h5>
              <div class="restaurant-rating">
                <i class="bi bi-star-fill"></i>
                <span>${restaurant.rating}</span>
                <small>(${restaurant.reviews} rese√±as)</small>
              </div>
              <p class="restaurant-category">${restaurant.category}</p>
              <div class="restaurant-meta">
                <span class="delivery-time">
                  <i class="bi bi-clock"></i> ${restaurant.deliveryTime}
                </span>
                <span class="delivery-fee">
                  <i class="bi bi-truck"></i> ${restaurant.deliveryFee}
                </span>
              </div>
              <button class="btn btn-primary w-100 mt-2" onclick="event.stopPropagation();location.href='/public/restaurant-menu.html?id=${restaurant.id}'">
                Ver Men√∫
              </button>
            </div>
          </div>
        `;

        return col;
      }

      function setupEventListeners() {
        // B√∫squeda (usar input principal de la hero)
        const searchInput = document.getElementById("mainSearch");
        if (searchInput) {
          searchInput.addEventListener("input", handleSearch);
        }

        // Filtros r√°pidos
        const filterButtons = document.querySelectorAll(".filter-btn");
        if (filterButtons && filterButtons.length) {
          filterButtons.forEach((btn) => {
            btn.addEventListener("click", handleFilter);
          });
        }

        // Ordenamiento
        const sortSelect = document.getElementById("sortRestaurants");
        if (sortSelect) {
          sortSelect.addEventListener("change", (e) => {
            const val = e.target.value;
            // Intentar usar la utilidad compartida; si falla, llamar al handler local
            try {
              sortAndRender(val);
            } catch (err) {
              handleSort(e);
            }
          });
        }

        // Inicializar botones de ofertas (Ordenar Ahora)
        // (sin manejadores personalizados)
      }

      function handleSearch(event) {
        const searchTerm = event.target.value.toLowerCase();
        console.log("Buscando:", searchTerm);
        // Implementar l√≥gica de b√∫squeda
      }

      function handleFilter(event) {
        // Remover clase active de todos los botones
        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.classList.remove("active");
        });

        // Agregar clase active al bot√≥n clickeado
        event.target.classList.add("active");

        const filter = event.target.dataset.filter;
        console.log("Filtro aplicado:", filter);
        // Implementar l√≥gica de filtrado
      }

      function handleSort(event) {
        const sortBy = event.target.value;
        console.log("Ordenar por:", sortBy);
        // Implementar l√≥gica de ordenamiento
      }

      function toggleFavorite(restaurantId) {
        console.log("Toggle favorito para restaurante:", restaurantId);
        // Implementar l√≥gica de favoritos
      }

      function viewRestaurant(restaurantId) {
        console.log("Ver restaurante:", restaurantId);
        // Redirigir a p√°gina de restaurante
        alert(
          `Funcionalidad en desarrollo - Ver men√∫ del restaurante ${restaurantId}`
        );
      }

      async function loadRecentOrders() {
        const row = document.getElementById('recentOrdersRow');
        const loading = document.getElementById('recentOrdersLoading');
        if (!row) return;

        try {
          const data = await authenticatedFetch('/api/v1/orders/my-orders?status=entregado&limit=3');
          if (!data || !data.ok) throw new Error('Respuesta inv√°lida');

          const orders = data.data || [];
          if (orders.length === 0) {
            row.innerHTML = `
              <div class=\"text-center py-5\">
                <i class=\"bi bi-bag\" style=\"font-size: 3rem; color: #c9c9c9;\"></i>
                <h5 class=\"mt-3\">Sin registros, realiza tu primera compra</h5>
                <p class=\"text-muted\">Tus pedidos aparecer√°n aqu√≠ cuando completes tu primera compra.</p>
                <a href=\"/public/restaurants.html\" class=\"btn btn-primary mt-2\"><i class=\"bi bi-shop\"></i> Ver restaurantes</a>
              </div>`;
            return;
          }

          row.innerHTML = orders.map(o => {
            const statusClass = o.status === 'entregado' ? 'delivered' : '';
            const total = Number(o.total || 0).toLocaleString('es-CO');
            const createdAt = new Date(o.created_at).toLocaleDateString('es-CO', { year:'numeric', month:'short', day:'numeric' });
            const logo = o.restaurant_logo || '/frontend/placeholder-restaurant.svg';
            const restName = o.restaurant_name || 'Restaurante';

            return `
              <div class=\"col-lg-4 col-md-6 mb-4\">
                <div class=\"order-card\">
                  <div class=\"order-header\">
                    <img src=\"${logo}\" alt=\"${restName}\" class=\"restaurant-logo\" onerror=\"this.style.display='none'\"/>
                    <div class=\"order-info\">
                      <h5>${restName}</h5>
                      <small class=\"text-muted\">${createdAt}</small>
                    </div>
                    <span class=\"order-status ${statusClass}\">${o.status}</span>
                  </div>
                  <div class=\"order-details\">
                    <div class=\"order-footer\">
                      <span class=\"order-total\">$${total}</span>
                      <a class=\"btn btn-sm btn-outline-primary\" href=\"/public/my-orders.html\">Ver Pedido</a>
                    </div>
                  </div>
                </div>
              </div>`;
          }).join('');
        } catch (e) {
          console.error(e);
          if (row) row.innerHTML = `
              <div class=\"text-center py-5\">\n                <i class=\"bi bi-bag\" style=\"font-size: 3rem; color: #c9c9c9;\"></i>\n                <h5 class=\"mt-3\">Sin registros, realiza tu primera compra</h5>\n                <p class=\"text-muted\">Tus pedidos aparecer√°n aqu√≠ cuando completes tu primera compra.</p>\n                <a href=\"/public/restaurants.html\" class=\"btn btn-primary mt-2\"><i class=\"bi bi-shop\"></i> Ver restaurantes</a>\n              </div>`;
        } finally {
          if (loading) loading.remove();
        }
      }

      function logout() {
        console.log("Logout function called");
        try {
          if (confirm("¬øEst√°s seguro de que deseas cerrar sesi√≥n?")) {
            localStorage.removeItem("token");
            localStorage.removeItem("user");
            window.location.href = "/login";
          }
        } catch (error) {
          console.error("Error in logout function:", error);
          alert("Error al cerrar sesi√≥n: " + error.message);
        }
      }

      // Inyectar comidas del restaurante 3 en la grilla de "Nuestro Men√∫"
      document.addEventListener('DOMContentLoaded', function() {
        try {
          const grid = document.querySelector('.menu-section .menu-grid');
          if (!grid || !window.guessFoodImage || !window.guessFoodImageCandidates) return;
          const items = [
            { name: 'Sushi Variado (12 piezas)', price: 42000, category: 'sushi' },
            { name: 'Sashimi de Salm√≥n', price: 38000, category: 'sushi' },
            { name: 'Rollo California', price: 28000, category: 'sushi' },
            { name: 'Rollo Philadelphia', price: 30000, category: 'sushi' },
            { name: 'Tempura de Camar√≥n', price: 26000, category: 'sushi' },
            { name: 'Edamame', price: 12000, category: 'sushi' },
            { name: 'T√© Verde', price: 8000, category: 'drink' }
          ];
          const frag = document.createDocumentFragment();
          items.forEach(it => {
            const div = document.createElement('div');
            div.className = 'col-lg-4 col-md-6 mb-4 menu-item';
            div.setAttribute('data-category', it.category || 'sushi');
            const img = window.guessFoodImage(it.name) || '/imagenes/comida/default.jpg';
            const candidates = window.guessFoodImageCandidates(it.name) || [];
            div.innerHTML = `
              <div class="menu-card">
                <div class="menu-image">
                  <img src="${img}" alt="${it.name}" data-candidates='${JSON.stringify(candidates)}' data-idx="0" onerror="window.tryNextFoodImage && window.tryNextFoodImage(this)">
                </div>
                <div class="menu-content">
                  <h4>${it.name}</h4>
                  <p>Especialidad fresca del restaurante</p>
                  <div class="menu-footer">
                    <span class="price">$${(it.price||0).toLocaleString('es-CO')}</span>
                    <button class="btn-add-cart" title="Agregar">
                      <i class="bi bi-cart-plus"></i>
                    </button>
                  </div>
                </div>
              </div>`;
            frag.appendChild(div);
          });
          grid.appendChild(frag);
        } catch (e) { console.warn('Sushi items injection failed:', e); }
      });
    </script>
  </body>
</html>
