<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Producto • DomiTulua</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/frontend/foodie.css" />
    <style>
      /* Estilos específicos mínimos para la página de producto */
      .product-page { padding: 32px 0; }
      .product-grid { display: grid; grid-template-columns: 1fr 1fr 360px; gap: 24px; align-items: start; }
      .product-image img { width: 100%; border-radius: 8px; object-fit: contain; background: #fff; }
      .product-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 8px; }
      .product-price { font-size: 2rem; color: #111; font-weight: 700; margin: 6px 0; }
      .product-badge { display:inline-block; background:#e9f7ff; color:#007bff; padding:6px 10px; border-radius:8px; font-weight:600; margin-bottom:8px; }
      .buy-panel { border: 1px solid #eee; border-radius: 12px; padding: 20px; background: #fff; }
      .buy-panel .btn-primary { width: 100%; padding: 12px 16px; font-size: 1.05rem; }
      .seller-info { font-size: 0.95rem; color:#666; margin-top:12px; }
      .product-desc { margin-top: 12px; color: #333; }
      @media (max-width: 991px) {
        .product-grid { grid-template-columns: 1fr; }
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg">
      <div class="container">
        <a class="navbar-brand" href="/">DomiTulua</a>
      </div>
    </nav>

    <main class="container product-page">
      <div class="product-grid">
        <div class="product-image">
          <img id="prod-img" src="" alt="Producto" />
        </div>

        <div>
          <div class="product-badge" id="prod-badge">Nuevo</div>
          <h1 class="product-title" id="prod-title">Título del producto</h1>
          <div class="product-price" id="prod-price">$0</div>
          <div class="product-desc" id="prod-desc">Descripción breve del producto.</div>
          <div class="mt-3">
            <button id="btn-add-cart" class="btn btn-outline-secondary">Agregar al carrito</button>
            <button id="btn-buy-now" class="btn btn-primary ms-2">Comprar ahora</button>
          </div>
          <div class="seller-info">
            <p><strong>Entrega a acordar con el vendedor</strong><br/>Medellín, Antioquia</p>
            <p><small>Stock disponible: <strong>1 unidad</strong> (3 disponibles)</small></p>
          </div>
        </div>

        <aside class="buy-panel">
          <h5>Resumen del pedido</h5>
          <p class="mb-1"><strong id="side-title">Producto</strong></p>
          <p class="mb-2 text-muted" id="side-price">$0</p>
          <div class="d-grid gap-2">
            <button id="side-buy" class="btn btn-primary">Comprar ahora</button>
            <button id="side-add" class="btn btn-outline-secondary">Agregar al carrito</button>
          </div>
          <div class="mt-3">
            <small>Vendido por <a href="#">Restaurante Ejemplo</a></small>
          </div>
        </aside>
      </div>
    </main>

    <script src="/frontend/js/index.js"></script>
    <script>
      // Parse query params and populate page
      const params = new URLSearchParams(window.location.search);
      const img = params.get('img') ? decodeURIComponent(params.get('img')) : '';
      const title = params.get('title') ? decodeURIComponent(params.get('title')) : 'Producto';
      const desc = params.get('desc') ? decodeURIComponent(params.get('desc')) : '';
      const price = params.get('price') ? decodeURIComponent(params.get('price')) : '';

      const imgEl = document.getElementById('prod-img');
      const titleEl = document.getElementById('prod-title');
      const descEl = document.getElementById('prod-desc');
      const priceEl = document.getElementById('prod-price');
      const sideTitle = document.getElementById('side-title');
      const sidePrice = document.getElementById('side-price');

      if (img) imgEl.src = img;
      titleEl.textContent = title;
      descEl.textContent = desc;
      priceEl.textContent = price;
      sideTitle.textContent = title;
      sidePrice.textContent = price;

      document.getElementById('btn-add-cart').addEventListener('click', function () {
        addToCart();
        // addToCart will redirect to /login if not authenticated
        alert('Agregado al carrito');
      });
      document.getElementById('btn-buy-now').addEventListener('click', function () {
        // require login before allowing to go to checkout
        const token = localStorage.getItem('token');
        if (!token) {
          try { sessionStorage.setItem('afterLoginRedirect', window.location.href); } catch (e) {}
          window.location.href = '/login';
          return;
        }
        window.location.href = '/checkout.html';
      });
      document.getElementById('side-buy').addEventListener('click', function () {
        const token = localStorage.getItem('token');
        if (!token) { try { sessionStorage.setItem('afterLoginRedirect', window.location.href); } catch (e) {} window.location.href = '/login'; return; }
        window.location.href = '/checkout.html';
      });
      document.getElementById('side-add').addEventListener('click', function () { addToCart(); alert('Agregado al carrito'); });
    </script>
  </body>
</html>
