<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard Admin - DomiTulua</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/frontend/foodie.css" />
    <link rel="stylesheet" href="/frontend/admin-dashboard.css" />
  </head>
  <body>
        <div class="d-flex">
          <!-- Sidebar -->
          <aside id="sidebar" class="sidebar bg-light border-end">
            <div
              class="sidebar-header d-flex align-items-center justify-content-between p-3"
            >
              <a href="/" class="text-decoration-none text-white d-flex align-items-center sidebar-brand" style="padding-left: 0.7rem;">
                <i class="bi bi-truck me-2" style="font-size: 1.2rem; width: 20px; text-align: center;"></i>
                <h4 class="mb-0" style="font-size: 1.3rem;"><span class="brand-text">DomiTulua</span></h4>
              </a>
            </div>
            <nav class="sidebar-menu list-group list-group-flush">
              <button
                class="list-group-item list-group-item-action menu-item active"
                onclick="showSection('dashboard')"
              >
                <i class="bi bi-house me-2"></i><span>Dashboard</span>
              </button>
              <button
                class="list-group-item list-group-item-action menu-item"
                onclick="showSection('users')"
              >
                <i class="bi bi-people me-2"></i><span>Usuarios</span>
              </button>
              <button
                class="list-group-item list-group-item-action menu-item"
                onclick="showSection('orders')"
              >
                <i class="bi bi-bag me-2"></i><span>Pedidos</span>
              </button>
              <button
                class="list-group-item list-group-item-action menu-item"
                onclick="showSection('restaurants')"
              >
                <i class="bi bi-shop me-2"></i><span>Restaurantes</span>
              </button>
              <button
                class="list-group-item list-group-item-action menu-item"
                onclick="showSection('delivery-applications')"
              >
                <i class="bi bi-bicycle me-2"></i
                ><span>Solicitudes domiciliarios</span>
              </button>
              <button
                class="list-group-item list-group-item-action menu-item"
                onclick="showSection('reports')"
              >
                <i class="bi bi-graph-up me-2"></i><span>Reportes</span>
              </button>
              <button
                class="list-group-item list-group-item-action menu-item"
                onclick="showSection('settings')"
              >
                <i class="bi bi-gear me-2"></i><span>Configuración</span>
              </button>
            </nav>
            <div class="sidebar-footer mt-auto p-3 border-top">
              <div class="d-flex align-items-center">
                <div
                  class="avatar bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center me-2"
                  style="width: 40px; height: 40px"
                >
                  <i class="bi bi-person"></i>
                </div>
                <div class="user-details">
                  <div id="adminName" class="fw-semibold">Admin</div>
                  <small class="text-white" id="adminRole">Administrador</small>
                </div>
              </div>
              <button
                class="btn btn-sm btn-outline-danger w-100 mt-3 btn-logout"
                type="button"
              >
                <i class="bi bi-box-arrow-right"></i>
                <span class="logout-text">Cerrar sesión</span>
              </button>
            </div>
          </aside>

          <!-- Main Content -->
          <main class="main-content flex-grow-1">
            <div class="container-fluid py-3">
              <div
                class="d-flex align-items-center justify-content-between mb-3"
              >
                <button
                  class="btn btn-outline-secondary btn-toggle-sidebar"
                  type="button"
                  onclick="toggleSidebar()"
                >
                  <i class="bi bi-list"></i>
                </button>
                <h2 id="pageTitle" class="mb-0">Dashboard</h2>
                <div></div>
              </div>

              <!-- Sections -->
              <section id="dashboard-section" class="content-section active">
                <div class="row g-3">
                  <div class="col-md-3">
                    <div class="card shadow-sm">
                      <div class="card-body">
                        <div
                          class="d-flex justify-content-between align-items-center"
                        >
                          <div>
                            <div class="text-muted">Usuarios</div>
                            <div id="totalUsers" class="h3 mb-0">0</div>
                            <small id="usersTrend" class="text-success"></small>
                          </div>
                          <i class="bi bi-people fs-2 text-primary"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="card shadow-sm">
                      <div class="card-body">
                        <div
                          class="d-flex justify-content-between align-items-center"
                        >
                          <div>
                            <div class="text-muted">Pedidos</div>
                            <div id="totalOrders" class="h3 mb-0">0</div>
                            <small
                              id="ordersTrend"
                              class="text-success"
                            ></small>
                          </div>
                          <i class="bi bi-bag fs-2 text-warning"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="card shadow-sm">
                      <div class="card-body">
                        <div
                          class="d-flex justify-content-between align-items-center"
                        >
                          <div>
                            <div class="text-muted">Restaurantes</div>
                            <div id="totalRestaurants" class="h3 mb-0">0</div>
                            <small
                              id="restaurantsTrend"
                              class="text-success"
                            ></small>
                          </div>
                          <i class="bi bi-shop fs-2 text-success"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="card shadow-sm">
                      <div class="card-body">
                        <div
                          class="d-flex justify-content-between align-items-center"
                        >
                          <div>
                            <div class="text-muted">Ingresos</div>
                            <div id="totalRevenue" class="h3 mb-0">$0</div>
                            <small
                              id="revenueTrend"
                              class="text-success"
                            ></small>
                          </div>
                          <i class="bi bi-cash-coin fs-2 text-danger"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="card mt-4 shadow-sm">
                  <div class="card-body">
                    <h5 class="card-title">Pedidos por día</h5>
                    <div style="height: 320px">
                      <canvas id="ordersChart"></canvas>
                    </div>
                  </div>
                </div>

                <div class="card mt-4 shadow-sm">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <h5 class="card-title mb-0">Restaurantes Populares</h5>
                      <small class="text-muted">Hoy</small>
                    </div>
                    <div id="popularRestaurantsContainer">
                      <div class="text-center py-4 text-muted">
                        Cargando restaurantes populares...
                      </div>
                    </div>
                  </div>
                </div>

                <div class="card mt-4 shadow-sm">
                  <div class="card-body">
                    <h5 class="card-title">Indicadores de Actividad de la Plataforma</h5>
                    <p class="text-muted small mb-3">S(t): Restaurantes activos | U(t): Usuarios activos | I(t): Pedidos cancelados</p>
                    <div style="height: 360px">
                      <canvas id="ecosystemChart"></canvas>
                    </div>
                  </div>
                </div>
              </section>

              <section id="users-section" class="content-section">
                <div class="d-flex align-items-center justify-content-between mb-4">
                  <h4 class="mb-0"><i class="bi bi-people me-2"></i>Gestión de Usuarios</h4>
                  <div class="d-flex gap-2">
                    <select id="roleFilter" class="form-select form-select-sm" style="width: auto">
                      <option value="">Todos los roles</option>
                      <option value="user">Usuario/Cliente</option>
                      <option value="delivery">Domiciliario</option>
                      <option value="admin">Administrador</option>
                    </select>
                    <input
                      id="searchUsers"
                      class="form-control form-control-sm"
                      placeholder="Buscar usuarios..."
                      style="width: 250px"
                    />
                  </div>
                </div>

                <div class="card">
                  <div class="card-body">
                    <div class="table-responsive">
                      <table class="table table-hover">
                        <thead>
                          <tr>
                            <th>ID</th>
                            <th>Usuario</th>
                            <th>Email</th>
                            <th>Nombre</th>
                            <th>Roles</th>
                            <th>Teléfono</th>
                            <th>Fecha Registro</th>
                            <th>Acciones</th>
                          </tr>
                        </thead>
                        <tbody id="usersTableBody">
                          <tr>
                            <td colspan="8" class="text-center">
                              <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Cargando...</span>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <div id="usersPagination" class="d-flex justify-content-between align-items-center mt-3">
                      <div>
                        <span id="usersCount">Total: 0 usuarios</span>
                      </div>
                    </div>
                  </div>
                </div>
              </section>

              <section id="orders-section" class="content-section">
                <div class="alert alert-info">
                  Gestión de pedidos próximamente.
                </div>
              </section>

              <section id="restaurants-section" class="content-section">
                <div class="d-flex align-items-center justify-content-between mb-3">
                  <h4 class="mb-0"><i class="bi bi-shop me-2"></i>Gestión de Restaurantes</h4>
                  <div class="d-flex gap-2">
                    <select id="restaurantsStatusFilter" class="form-select form-select-sm" style="width:auto">
                      <option value="all">Todos</option>
                      <option value="pending">Pendientes</option>
                      <option value="active" selected>Aceptados</option>
                    </select>
                    <input id="restaurantsSearch" class="form-control form-control-sm" style="width:240px" placeholder="Buscar restaurante...">
                    <button id="restaurantsRefresh" class="btn btn-sm btn-outline-secondary"><i class="bi bi-arrow-repeat"></i></button>
                  </div>
                </div>
                <div class="card">
                  <div class="card-body">
                    <div id="restaurantsLoading" class="text-center py-4 d-none">
                      <div class="spinner-border" role="status"><span class="visually-hidden">Cargando...</span></div>
                      <div class="mt-2">Cargando restaurantes...</div>
                    </div>
                    <div id="restaurantsEmpty" class="alert alert-secondary d-none">No hay restaurantes para mostrar.</div>
                    <div class="table-responsive">
                      <table class="table align-middle">
                        <thead>
                          <tr>
                            <th>Logo</th>
                            <th>Nombre</th>
                            <th>Categoría</th>
                            <th>Contacto</th>
                            <th>Pedidos</th>
                            <th>Rating</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                          </tr>
                        </thead>
                        <tbody id="restaurantsTableBody">
                          <tr><td colspan="8" class="text-center text-muted">Usa los filtros para cargar restaurantes</td></tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </section>

              <section
                id="delivery-applications-section"
                class="content-section"
              >
                <div
                  class="d-flex align-items-center justify-content-between mb-3"
                >
                  <h4 class="mb-0">Solicitudes de domiciliarios</h4>
                  <div class="d-flex gap-2">
                    <select
                      id="statusFilter"
                      class="form-select form-select-sm"
                      style="width: auto"
                    >
                      <option value="">Estado: Todos</option>
                      <option value="pendiente">Pendiente</option>
                      <option value="aprobada">Aprobada</option>
                      <option value="rechazada">Rechazada</option>
                    </select>
                    <select
                      id="vehicleFilter"
                      class="form-select form-select-sm"
                      style="width: auto"
                    >
                      <option value="">Vehículo: Todos</option>
                      <option value="a_pie">A pie</option>
                      <option value="bicicleta">Bicicleta</option>
                      <option value="moto">Moto</option>
                      <option value="carro">Carro</option>
                    </select>
                    <input
                      id="searchApplications"
                      class="form-control form-control-sm"
                      placeholder="Buscar..."
                    />
                  </div>
                </div>

                <div class="row g-3 mb-3">
                  <div class="col-md-3">
                    <div class="card text-bg-warning">
                      <div class="card-body">
                        <div class="small">Pendientes</div>
                        <div id="pendingApplications" class="h4 mb-0">0</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="card text-bg-success">
                      <div class="card-body">
                        <div class="small">Aprobadas</div>
                        <div id="approvedApplications" class="h4 mb-0">0</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="card text-bg-danger">
                      <div class="card-body">
                        <div class="small">Rechazadas</div>
                        <div id="rejectedApplications" class="h4 mb-0">0</div>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="card text-bg-primary">
                      <div class="card-body">
                        <div class="small">Total</div>
                        <div id="totalApplications" class="h4 mb-0">0</div>
                      </div>
                    </div>
                  </div>
                </div>

                <div id="applicationsLoading" class="text-center py-4 d-none">
                  <div class="spinner-border" role="status">
                    <span class="visually-hidden">Cargando...</span>
                  </div>
                  <div class="mt-2">Cargando solicitudes...</div>
                </div>

                <div
                  id="noApplicationsMessage"
                  class="alert alert-secondary d-none"
                >
                  No hay solicitudes para mostrar.
                </div>

                <div class="table-responsive">
                  <table class="table align-middle">
                    <thead>
                      <tr>
                        <th>Solicitante</th>
                        <th>Contacto</th>
                        <th>Transporte</th>
                        <th>Fecha</th>
                        <th>Estado</th>
                        <th>Docs</th>
                        <th>Acciones</th>
                      </tr>
                    </thead>
                    <tbody id="applicationsTableBody"></tbody>
                  </table>
                </div>
              </section>

              <section id="reports-section" class="content-section">
                <div class="card shadow-sm">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <h5 class="card-title mb-0">Restaurantes Populares</h5>
                      <select id="popularRangeReports" class="form-select form-select-sm" style="width: auto;">
                        <option value="day" selected>Hoy</option>
                        <option value="week">Última semana</option>
                        <option value="month">Último mes</option>
                      </select>
                    </div>
                    <div id="popularRestaurantsReportsContainer">
                      <div class="text-center py-4 text-muted">Seleccione un rango para ver resultados</div>
                    </div>
                  </div>
                </div>
              </section>

              <section id="settings-section" class="content-section">
                <div class="alert alert-info">
                  Configuraciones próximamente.
                </div>
              </section>
            </div>
          </main>
        </div>

        <!-- Review Application Modal -->
        <div
          class="modal fade"
          id="reviewApplicationModal"
          tabindex="-1"
          aria-labelledby="reviewApplicationLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="reviewApplicationLabel">
                  Revisar solicitud
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body">
                <input type="hidden" id="applicationId" />
                <div id="applicationDetails" class="mb-3"></div>
                <form
                  id="reviewForm"
                  onsubmit="event.preventDefault(); submitReview();"
                >
                  <div class="row g-3">
                    <div class="col-md-6">
                      <label for="applicationStatus" class="form-label"
                        >Decisión</label
                      >
                      <select
                        id="applicationStatus"
                        class="form-select"
                        required
                      >
                        <option value="">Selecciona...</option>
                        <option value="aprobada">Aprobar</option>
                        <option value="rechazada">Rechazar</option>
                      </select>
                    </div>
                    <div class="col-md-6">
                      <label for="applicationObservations" class="form-label"
                        >Observaciones</label
                      >
                      <textarea
                        id="applicationObservations"
                        class="form-control"
                        rows="3"
                        placeholder="Opcional"
                      ></textarea>
                    </div>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Cerrar
                </button>
                <button
                  type="button"
                  class="btn btn-primary"
                  onclick="submitReview()"
                >
                  Guardar
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- User Details Modal -->
        <div
          class="modal fade"
          id="userDetailsModal"
          tabindex="-1"
          aria-labelledby="userDetailsModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="userDetailsModalLabel">
                  Detalles del Usuario
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <div class="modal-body" id="userDetailsContent">
                <div class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                  </div>
                </div>
              </div>
              <div class="modal-footer">
                <button
                  type="button"
                  class="btn btn-secondary"
                  data-bs-dismiss="modal"
                >
                  Cerrar
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Edit User Modal -->
        <div
          class="modal fade"
          id="editUserModal"
          tabindex="-1"
          aria-labelledby="editUserModalLabel"
          aria-hidden="true"
        >
          <div class="modal-dialog modal-lg">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="editUserModalLabel">
                  Editar Usuario
                </h5>
                <button
                  type="button"
                  class="btn-close"
                  data-bs-dismiss="modal"
                  aria-label="Close"
                ></button>
              </div>
              <form id="editUserForm">
                <div class="modal-body">
                  <input type="hidden" id="editUserId" />
                  
                  <div class="row">
                    <!-- Columna izquierda -->
                    <div class="col-md-6">
                      <h6 class="fw-bold mb-3">Información de Cuenta</h6>
                      
                      <div class="mb-3">
                        <label for="editUsername" class="form-label">Usuario *</label>
                        <input type="text" class="form-control" id="editUsername" required />
                      </div>

                      <div class="mb-3">
                        <label for="editEmail" class="form-label">Email *</label>
                        <input type="email" class="form-control" id="editEmail" required />
                      </div>

                      <h6 class="fw-bold mb-3 mt-4">Información Personal</h6>

                      <div class="mb-3">
                        <label for="editCedula" class="form-label">Cédula</label>
                        <input type="text" class="form-control" id="editCedula" />
                      </div>

                      <div class="mb-3">
                        <label for="editNombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="editNombre" />
                      </div>

                      <div class="mb-3">
                        <label for="editApellidos" class="form-label">Apellidos</label>
                        <input type="text" class="form-control" id="editApellidos" />
                      </div>
                    </div>

                    <!-- Columna derecha -->
                    <div class="col-md-6">
                      <h6 class="fw-bold mb-3">Información de Contacto</h6>

                      <div class="mb-3">
                        <label for="editTelefono1" class="form-label">Teléfono Principal</label>
                        <input type="text" class="form-control" id="editTelefono1" />
                      </div>

                      <div class="mb-3">
                        <label for="editTelefono2" class="form-label">Teléfono Secundario</label>
                        <input type="text" class="form-control" id="editTelefono2" />
                      </div>

                      <h6 class="fw-bold mb-3 mt-4">Dirección</h6>

                      <div class="mb-3">
                        <label for="editDireccion" class="form-label">Dirección</label>
                        <textarea class="form-control" id="editDireccion" rows="2"></textarea>
                      </div>

                      <div class="mb-3">
                        <label for="editDepartamento" class="form-label">Departamento</label>
                        <select class="form-select" id="editDepartamento">
                          <option value="">Seleccione un departamento</option>
                        </select>
                      </div>

                      <div class="mb-3">
                        <label for="editMunicipio" class="form-label">Municipio</label>
                        <select class="form-select" id="editMunicipio" disabled>
                          <option value="">Primero seleccione un departamento</option>
                        </select>
                      </div>
                    </div>
                  </div>

                  <div class="alert alert-info mt-3">
                    <i class="bi bi-info-circle"></i>
                    Los campos marcados con * son obligatorios. Los roles se gestionan desde un módulo independiente.
                  </div>
                </div>
                <div class="modal-footer">
                  <button
                    type="button"
                    class="btn btn-secondary"
                    data-bs-dismiss="modal"
                  >
                    Cancelar
                  </button>
                  <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save"></i> Guardar Cambios
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <!-- Notifications -->
        <div
          id="notificationContainer"
          class="toast-container position-fixed bottom-0 end-0 p-3"
        ></div>

        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="/frontend/js/common.js"></script>
        <script src="/frontend/js/admin-dashboard.js"></script>
      </body>
    </html>
